# Test Coverage for VSPlot

## Overview

This document describes the comprehensive test coverage for the VSPlot data parser, including edge cases and robustness testing.

## Test Suites

### 1. Comment Line Handling Tests (`comment.test.ts`)

- **8 tests** covering comment line filtering functionality
- Tests for hash (#), percent (%), and slash (//) comment markers
- Custom comment marker configuration
- Mixed comment markers in same file
- Files with only comments
- Comments in middle of data

### 2. Delimiter Detection Tests (`delimiter.test.ts`)

- **8 tests** covering delimiter auto-detection
- Tests for common delimiters: comma, pipe, semicolon, colon, tab, space
- Delimiter override functionality
- Consistency-based delimiter detection
- Single column fallback handling

### 3. Edge Cases and Robustness Tests (`edgecases.test.ts`)

- **14 tests** covering comprehensive edge cases
- Empty file handling
- Whitespace-only files
- Mixed delimiters in same file
- Malformed data with inconsistent column counts
- Large dataset handling (10,000 rows)
- Special characters in data (Unicode, emojis, etc.)
- Very long lines (1000+ characters per cell)
- Numeric-only data header detection
- Mixed numeric/text headers
- BOM (Byte Order Mark) handling
- Header-only files (no data rows)
- Trailing and leading empty lines
- Quoted values containing delimiters (CSV edge case)

### 4. Extension Integration Tests (`extension.test.ts`)

- **14 tests** covering extension functionality
- Data preview and plotting commands
- Chart type configurations
- Multiple file format support (.csv, .json, .tsv, .tab, .out, .data)
- Chart features (aggregation, multiple axes, etc.)

### 5. Webview Utils Tests (`webviewUtils.test.ts`)

- **5 tests** covering webview utility functions
- getNonce() function testing (uniqueness, format)
- loadHtmlTemplate() with single and multiple placeholders
- Template placeholder replacement edge cases
- Empty value handling

### 6. JSON Parsing Tests (`json.test.ts`)

- **9 tests** covering JSON data parsing
- Array of primitives (strings, numbers, mixed types)
- Single object parsing
- Empty arrays
- Null values in objects
- Invalid JSON error handling
- Primitive JSON values (not arrays/objects)

### 7. CSV Parsing Edge Cases Tests (`csvParsing.test.ts`)

- **10 tests** covering CSV parsing edge cases
- Quoted fields containing commas
- Empty quoted fields
- Trailing commas
- BOM (Byte Order Mark) handling
- Header-only files
- All-numeric data (auto-generated headers)
- Mixed numeric/text headers
- Leading/trailing empty lines
- Trimming spaces around values

### 8. Data Commands Tests (`dataCommands.test.ts`)

- **8 tests** covering command execution and error handling
- Unsupported file type handling
- TSV, TAB, OUT, DATA file format support
- JSON array of objects
- Error handling in command layer

## Coverage Metrics

### Target Thresholds

- **Lines**: 75%
- **Functions**: 75%
- **Branches**: 75%
- **Statements**: 75%

Thresholds are enforced by `scripts/check-coverage.mjs`, which fails `npm run test:coverage` if coverage drops below the required values.

Coverage include/exclude patterns and reporters are defined in `.vscode-test.mjs` so the `vscode-test` CLI produces the same output locally and in CI.

## Running Tests

### Run all tests:

```bash
npm test
```

### Run tests with coverage:

```bash
npm run test:coverage
```

### View coverage report:

After running coverage, open `coverage/index.html` in a browser.

## Coverage Reporting

Coverage reports are automatically generated and uploaded to Codecov on every push and pull request via GitHub Actions.

- **Codecov Dashboard**: https://codecov.io/gh/Anselmoo/vsplot
- **Coverage Badge**: Displayed in README.md

## Edge Cases Covered

1. **Empty and Whitespace Files**: Ensures proper error handling
2. **Delimiter Ambiguity**: Tests consistency-based detection when multiple delimiters exist
3. **Malformed Data**: Handles rows with inconsistent column counts gracefully
4. **Large Datasets**: Validates performance with 10,000+ row files
5. **Special Characters**: Preserves Unicode, emojis, and special symbols
6. **Header Detection**: Distinguishes between numeric data and headers
7. **Comment Filtering**: Supports multiple comment marker types
8. **File Format Variations**: Handles BOM, empty lines, quoted delimiters

## Test Data

Test fixtures are automatically generated by `scripts/setup-test-data.sh` and stored in the `test-data/` directory (gitignored).

## CI/CD Integration

The GitHub Actions workflow (`.github/workflows/release.yml`) includes:

1. Linting
2. Compilation
3. Test data setup
4. Test execution
5. Coverage generation
6. Coverage upload to Codecov

## Future Enhancements

Potential areas for expanded test coverage:

- Performance benchmarking for very large files (100K+ rows)
- Streaming parser for memory efficiency
- Additional file format support
- Error recovery strategies for corrupt files
